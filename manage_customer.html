<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Manage Customer</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="bootstrap/js/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
      integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
      crossorigin="anonymous"
    />
    <link rel="shortcut icon" href="" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="css/sidenav.css" />
    <link rel="stylesheet" href="css/home.css" />
    <script src="js/manage_customer.js"></script>
    <script src="js/validateForm.js"></script>
    <script src="js/restrict.js"></script>
  </head>
  <body style="max-height: 100%" cz-shortcut-listen="true" ng-app="customerApp" ng-controller="customerController">
    <!-- including side navigations -->
    <script type="text/javascript">
      var pid = "none";
      function showhide(id) {
        var elements = document.getElementById(id).childNodes;
        var menu = elements[3];
        var arrow = elements[1].childNodes[4].childNodes[1];
        if (menu.style.display == "block") {
          menu.style.display = "none";
          arrow.style.transform = "rotate(0deg)";
          elements[1].style.color = "#eeeeee";
        } else {
          menu.style.display = "block";
          arrow.style.transform = "rotate(270deg)";
          elements[1].style.color = "#ff5252";
        }
        if (pid == id) pid = "none";
        if (pid != "none") {
          elements = document.getElementById(pid).childNodes;
          menu = document.getElementById(pid).childNodes[3];
          arrow = elements[1].childNodes[4].childNodes[1];
          if (menu.style.display == "block") {
            menu.style.display = "none";
            arrow.style.transform = "rotate(0deg)";
            elements[1].style.color = "#eeeeee";
          }
        }
        pid = id;
      }

      function showOptions() {
        var flag = document.getElementById("options");
        if (flag.style.display == "block") {
          flag.style.display = "none";
          document.getElementById("mark").style.display = "none";
        } else {
          flag.style.display = "block";
          document.getElementById("mark").style.display = "block";
        }
      }
    </script>

    <div class="sidenav">
      <div class="card">
        <div class="card-body">
          <div class="logo">
            <img src="images/prof.jpg" class="profile" />
            <h1 class="logo-caption"><span class="tweak">A</span>dmin</h1>
          </div>
          <!-- logo class -->

          <!-- dashboard start -->
          <div class="main-menu-item">
            <a href="home.html"
              ><i class="fa fa-dashboard"></i><span>Dashboard</span></a
            >
          </div>
          <!-- dashboard end -->

          <!-- invoice strat -->
          <div id="first" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-balance-scale"></i><span>Invoice</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview">
                <a href="new_invoice.html">New Invoice</a>
              </li>
              <li class="treeview">
                <a href="manage_invoice.html">Manage Invoice </a>
              </li>
            </ul>
          </div>
          <!-- invoice end -->

          <!-- customer end -->
          <div id="second" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-handshake"></i><span>Customer</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview">
                <a href="add_customer.html">Add Customer</a>
              </li>
              <li class="treeview">
                <a href="manage_customer.html">Manage Customer</a>
              </li>
            </ul>
          </div>
          <!-- customer end -->

          <!-- medicine strat -->
          <div id="third" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-shopping-bag"></i><span>Medicine</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview">
                <a href="add_medicine.html">Add Medicine</a>
              </li>
              <li class="treeview">
                <a href="manage_medicine.html">Manage Medicine</a>
              </li>
              <li class="treeview">
                <a href="manage_medicine_stock.html">Manage Medicine Stock</a>
              </li>
            </ul>
          </div>
          <!-- medicine end -->

          <!-- manufacturer start -->
          <div id="fourth" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-group"></i><span>Supplier</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview">
                <a href="add_supplier.html">Add Supplier</a>
              </li>
              <li class="treeview">
                <a href="manage_supplier.html">Manage Supplier</a>
              </li>
            </ul>
          </div>
          <!-- manufacturer end -->

          <!-- purchase start -->
          <div id="fifth" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-bar-chart"></i><span>Purchase</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview">
                <a href="add_purchase.html">Add Purchase</a>
              </li>
              <li class="treeview">
                <a href="manage_purchase.html">Manage Purchase</a>
              </li>
            </ul>
          </div>
          <!-- purchase end -->

          <!-- report start -->
          <div id="sixth" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-book"></i><span>Report</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview">
                <a href="sales_report.html">Sales Report</a>
              </li>
              <li class="treeview">
                <a href="purchase_report.html">Purchase Report</a>
              </li>
            </ul>
          </div>
          <!-- report end -->

          <!-- search start -->
          <div id="seventh" class="main-menu-item" onclick="showhide(this.id);">
            <a href="#">
              <i class="fa fa-search"></i><span>Search</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu" style="display: none">
              <li class="treeview"><a href="manage_invoice.html">Invoice</a></li>
              <li class="treeview">
                <a href="manage_customer.html">Customer</a>
              </li>
              <li class="treeview">
                <a href="manage_medicine.html">Medicine</a>
              </li>
              <li class="treeview">
                <a href="manage_supplier.html">Supplier</a>
              </li>
              <li class="treeview">
                <a href="manage_purchase.html">Purchase</a>
              </li>
            </ul>
          </div>
          <!-- search end -->
        </div>
        <!-- card-body class -->
      </div>
      <!-- card  -->
    </div>

    <div class="container-fluid">
      <div class="container">
        <!-- header section -->

        <section class="row content-header">
          <div class="header-title col-md-11">
            <p class="h4 pt-2">
              <i class="fa fa-handshake"></i>&emsp;Manage Customer
            </p>
            &emsp;&emsp;&emsp;<small class="font-weight-bold h6"
              >Manage Existing Customer</small
            >
          </div>
          <div class="col-md-1 user_options">
            <button class="col col-md-1 m-3" onclick="showOptions();">
              <i class="fa fa-gear"></i>
            </button>
            <div id="mark"><i class="fa fa-play fa-rotate-270"></i></div>
            <ul
              id="options"
              class="options list-unstyled"
              style="display: none"
            >
              <li>
                <a href="my_profile.html"
                  ><i class="fa fa-user"></i><span>My Profile</span></a
                >
              </li>
              <li>
                <a href="change_password.html"
                  ><i class="fa fa-edit"></i><span>Change Password</span></a
                >
              </li>
              <li>
                <a href="logout.html"
                  ><i class="fa fa-key"></i><span>Logout</span></a
                >
              </li>
            </ul>
          </div>
        </section>
        <hr style="border-top: 2px solid #ff5252" />
        <!-- header section end -->

        <!-- form content -->
        <div class="row">
          <div class="col-md-12 form-group form-inline">
            <label class="font-weight-bold" for="">Search :&emsp;</label>
            <input
              type="text"
              class="form-control"
              id=""
              placeholder="Search Customer"
              onkeyup="searchCustomer(this.value);"
            />
          </div>

          <div class="col col-md-12">
            <hr
              class="col-md-12"
              style="padding: 0px; border-top: 2px solid #02b6ff"
            />
          </div>

          <div class="col col-md-12 table-responsive">
            <div class="table-responsive">
              <table class="table table-bordered table-striped table-hover">
                <thead>
                  <tr>
                    <th style="width: 2%">SL.</th>
                    <th style="width: 10%">Customer ID</th>
                    <th style="width: 13%">Customer Name</th>
                    <th style="width: 13%">Contact Number</th>
                    <th style="width: 17%">Address</th>
                    <th style="width: 13%">Doctor's Name</th>
                    <th style="width: 17%">Doctor's Address</th>
                    <th style="width: 15%">Action</th>
                  </tr>
                </thead>
                <tbody id="customers_div">
                    <tr ng-repeat="(key, customer) in customers">
                        <td>{{ key+1 }}</td>
                        <td>{{ customer._id }}</td>
                        <td>{{ customer.customerName }}</td>
                        <td>{{ customer.contactNumber }}</td>
                        <td>{{ customer.address }}</td>
                        <td>{{ customer.doctorName }}</td>
                        <td>{{ customer.doctorAddress }}</td>
                        <td>
                            <button
                                ng-click="editCustomer(key)"
                              class="btn btn-info btn-sm"
                            >
                              <i class="fa fa-pencil"></i>
                            </button>
                            <button
                                ng-click="deleteCustomer(key)"
                              class="btn btn-danger btn-sm"
                            >
                              <i class="fa fa-trash"></i>
                            </button>
                          </td>
                    </tr>
                  <!-- <tr>
                    <td>1</td>
                    <td>6</td>
                    <td>Aditya</td>
                    <td>7365687269</td>
                    <td>Virar West</td>
                    <td>Xyz</td>
                    <td>Virar West</td>
                    <td>
                      <button
                        href=""
                        class="btn btn-info btn-sm"
                        onclick="editCustomer(6);"
                      >
                        <i class="fa fa-pencil"></i>
                      </button>
                      <button
                        class="btn btn-danger btn-sm"
                        onclick="deleteCustomer(6);"
                      >
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>15</td>
                    <td>Pranav</td>
                    <td>9361213492</td>
                    <td>Coimbatore</td>
                    <td>Raj</td>
                    <td>Ettimadai, Coimbatore</td>
                    <td>
                      <button
                        href=""
                        class="btn btn-info btn-sm"
                        onclick="editCustomer(15);"
                      >
                        <i class="fa fa-pencil"></i>
                      </button>
                      <button
                        class="btn btn-danger btn-sm"
                        onclick="deleteCustomer(15);"
                      >
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr> -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- form content end -->
        <hr style="border-top: 2px solid #ff5252" />
      </div>

      <div class="container" ng-show="showForm">
        <form ng-submit="submit()">
            <div class="form-group">
                <label>Customer Name</label>
                <input type="text" class="form-control" ng-model="customerName" name="customerName" disabled>
            </div>
            <div class="form-group">
                <label>Contact Number</label>
                <input type="number" minlength="10" maxlength="10" class="form-control" ng-model="contactNumber" name="contactNumber" required>
            </div>
            <div class="form-group">
                <label>Address</label>
                <input type="text" class="form-control" ng-model="address" name="address" required>
            </div>
            <div class="form-group">
                <label>Doctor's Name</label>
                <input type="text" class="form-control" ng-model="doctorName" name="doctorName" required>
            </div>
            <div class="form-group">
                <label>Doctor's Address</label>
                <input type="text" class="form-control" ng-model="doctorAddress" name="doctorAddress" required>
            </div>
            <button type="submit" class="btn btn-info">Update</button>
        </form>
      </div>
    </div>

    <script>
      var mainApp = angular.module("customerApp", []);
      mainApp.controller("customerController", function ($scope, $http) {
        $scope.customers = [];
        $scope.showForm = false;
        $scope.custId = '';
        $scope.selectedIdx = 0;

        $http({
            url: "http://localhost:3000/api/customer",
            method: "GET"
        }).then(
        function (res) {
            $scope.successMsg = "Saved Successfully";
            $scope.customers = res.data;

            console.log(res.data);
        },
        function (res) {
            // optional
            // failed
            alert("Error: " + res.message);
        });

        $scope.deleteCustomer = function(index) {
            let cust = $scope.customers;
            let custId = $scope.customers[index]._id;
            cust.splice(index, 1);
            $scope.customers = cust;

            $http({
                url: `http://localhost:3000/api/customer/${custId}`,
                method: "DELETE"
            }).then(
            function (res) {
                // $scope.successMsg = "Deleted Successfully";
                // $scope.customers = res.data;

                console.log(res.data);
            },
            function (res) {
                // optional
                // failed
                alert("Error: " + res.message);
            });
        }

        $scope.editCustomer = function(key) {
            $scope.selectedIdx = key;

            let cust = $scope.customers[key];
            $scope.custId = cust._id;
            $scope.customerName = cust.customerName;
            $scope.contactNumber = cust.contactNumber;
            $scope.address = cust.address;
            $scope.doctorName = cust.doctorName;
            $scope.doctorAddress = cust.doctorAddress;
            $scope.showForm = true;
        };

        $scope.reset = function() {
            $scope.customerName = '';
            $scope.contactNumber = '';
            $scope.address = '';
            $scope.doctorName = '';
            $scope.doctorAddress = '';
            $scope.showForm = false;
        };

        $scope.submit = function () {
            // console.log('hoi');
          // console.log("jgjgjh");
          var customerData = {
            customerName: $scope.customerName,
            contactNumber: $scope.contactNumber,
            address: $scope.address,
            doctorName: $scope.doctorName,
            doctorAddress: $scope.doctorAddress,
          };

          

          console.log(customerData);

          $http({
            url: `http://localhost:3000/api/customer/${$scope.custId}`,
            method: "PUT",
            data: customerData
          }).then(
            function (res) {
              $scope.successMsg = "Updated Successfully";
              console.log(res.data);
              let dat = $scope.customers;
              dat[$scope.selectedIdx] = res.data;
              $scope.customers = dat;
              $scope.reset();
            },
            function (res) {
              // optional
              // failed
              alert("Error: " + res.message);
            }
          );
        };

        // $scope.reset();
      });
    </script>
  </body>
</html>
